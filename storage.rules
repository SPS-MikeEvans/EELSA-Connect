
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    
    // Helper functions
    function isSignedIn() {
      return request.auth != null;
    }
    
    // Resource thumbnails
    match /thumbnails/{allPaths=**} {
      allow read: if isSignedIn();
      allow write: if isSignedIn(); 
    }

    match /resources/{allPaths=**} {
      allow read: if isSignedIn();
      allow write: if isSignedIn(); // Refine this based on actual app logic (e.g. only trainers)
    }
    
    match /feedback/{fileName} {
      allow write: if isSignedIn() && request.resource.size < 5 * 1024 * 1024; // 5MB limit
      allow read: if isSignedIn(); // Or restrict to admins if possible
    }
    
    // User Profile Pictures
    match /profile_pictures/{userId}/{fileName} {
        allow read: if isSignedIn();
        allow write: if isSignedIn() && request.auth.uid == userId;
    }
  }
}
