
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    
    // Helper functions
    function isSignedIn() {
      return request.auth != null;
    }
    function isAdmin() {
      // Assuming you have a way to check admin status via custom claims or Firestore (which is hard in storage rules)
      // For now, relying on simple auth checks or specific paths.
      // Ideally, use Custom Claims for 'admin'.
      return isSignedIn() && request.auth.token.role == 'Admin'; 
    }

    match /resources/{allPaths=**} {
      allow read: if isSignedIn();
      allow write: if isSignedIn(); // Refine this based on actual app logic (e.g. only trainers)
    }
    
    match /feedback/{fileName} {
      allow write: if isSignedIn() && request.resource.size < 5 * 1024 * 1024; // 5MB limit
      allow read: if isSignedIn(); // Or restrict to admins if possible
    }
    
    // ... other existing rules ...
  }
}
